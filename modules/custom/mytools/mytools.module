<?php

use Drupal\user\Entity\User;
use Drupal\Core\Url;
use Drupal\taxonomy\Entity\Vocabulary;

/**
 * Implements hook_entity_type_alter().
 * Alterons dynamiquement les urls des terms de taxonomy afin de les faire correspondre aux filtres de recherche
 */
function mytools_entity_type_alter(array &$entity_types) {
  // Unset the canonical link template for node content type and
  // replace with a uri callback.
  // Unsetting the uri template is necessary for the uri callbacks to work.
  $entity_types['taxonomy_term']->setUriCallback('mytools_taxonomy_uri');
  $links = $entity_types['taxonomy_term']->get('links');
  unset($links['canonical']);
  $entity_types['taxonomy_term']->set('links', $links);
}

/**
 * alter paths for the specific agenda taxonomy terms 
 */
function mytools_taxonomy_uri($term) {
	if ($term->bundle() == 'date') 
		return Url::fromRoute('view.agenda.page_1', ['field_date_target_id[]' => $term ->id()]);
	elseif ($term->bundle() == 'horaires') 
		return Url::fromRoute('view.agenda.page_1', ['field_horaire_target_id[]' => $term ->id()]);
	elseif ($term->bundle() == 'salle') 
		return Url::fromRoute('view.agenda.page_1', ['field_salle_target_id[]' => $term ->id()]);
	elseif ($term->bundle() == 'legende') 
		return Url::fromRoute('view.agenda.page_1', ['field_legende_target_id[]' => $term ->id()]);
	elseif ($term->bundle() == 'motscles') 
		return Url::fromRoute('view.agenda.page_1', ['field_mot_s_cle_s__target_id[]' => $term ->id()]);
	
	//by default (native)
	return new Url('entity.taxonomy_term.canonical', array(
		'taxonomy_term' => $term ->id(),
	));
}